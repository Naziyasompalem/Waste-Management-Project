{% endblock content %}
{% extends "base.html" %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Waste Management Competition</title>
  <style>
    /* Grid Layout for Responsive Design */
    body {
      display: grid;
      grid-template-rows: auto 1fr auto; /* Header, Content, Footer */
      min-height: 100vh; /* Ensures full viewport height */
      font-family: 'Arial', sans-serif; /* Font style */
      margin: 0; /* Remove default margin */
      background-color: #f4f4f9; /* Light background color */
    }

    header, main, footer {
      padding: 20px;
    }

    /* Header Styling */
    header {
      background-color: #2ecc71; /* Green header */
      color: white;
      text-align: center; /* Center-align header content */
    }

    h1 {
      font-size: 32px;
      margin-bottom: 10px;
      padding: 10px;
    }

    p {
      font-size: 18px;
      margin-bottom: 10px;
    }

    /* Content Section Styling */
    main {
      display: flex;
      flex-direction: column;
      justify-content: center; /* Center-align content horizontally */
      align-items: center; /* Center-align content vertically */
    }

    .content-wrapper {
      display: flex;
      width: 100%;
      max-width: 1200px;
    }

    .winner-table {
      margin-top: 20px;
      border-collapse: collapse;
      width: 100%;
      max-width: 450px; /* Limit table width for better alignment */
      border: none; /* Remove table border */
      background-color: white; /* Ensure readability */
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* Add subtle shadow */
      margin-left: 20px; /* Margin for spacing */
      max-height: 290px; /* Maximum height of the table */
      overflow-y: auto; /* Enable vertical scroll if content exceeds max-height */
    }

    th, td {
      border: none; /* Remove border */
      padding: 10px;
      text-align: center;
      font-size: 16px;
    }

    th {
      background-color: #f0f0f0; /* Light gray background for headers */
      color: #333; /* Dark text color */
      font-weight: bold;
      text-transform: uppercase;
    }

    tr:nth-child(even) {
      background-color: #ecf0f1; /* Light gray alternate row color */
    }

    .winner-award { /* Highlight winner award column */
      color: #f39c12; /* Orange text color */
      font-weight: bold;
    }

    .chart-container {
      width: 100%;
      max-width: 800px;
      margin-top: 20px;
      padding: 20px;
      background-color: white;
      border: 2px solid #ddd;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .chart-heading {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .user-rank-box {
      width: 100%;
      max-width: 800px;
      padding: 20px;
      background-color: white;
      border: 2px solid #ddd;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      margin-top: 20px;
      text-align: center;
    }

    .box-heading {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .rank-info {
      font-size: 18px;
      margin-top: 10px;
    }

    /* Footer Styling */
    footer {
      background-color: #2ecc71; /* Green footer */
      color: white;
      text-align: center;
      grid-row-start: 3; /* Ensures footer is at the bottom */
      grid-row-end: 4; /* Ensures footer is at the bottom */
    }

    a {
      color: white; /* White for call to action link */
      text-decoration: none; /* Remove underline */
      font-weight: bold; /* Bold text */
    }

    /* Table Hover Effect */
    tr:hover {
      background-color: #f2f2f2; /* Light gray hover color */
    }
  </style>
</head>
<body>
  <header>
    <h1>Waste Management Competition</h1>
    <p>A friendly competition to encourage responsible waste management practices.</p>
  </header>
  <main>
    <div class="user-rank-box" id="userRankBox">
      <div class="box-heading">Your Rank</div>
      <div class="rank-info" id="userRankInfo">Loading...</div>
    </div>
    <div class="content-wrapper">
      <div class="chart-container">
        <div class="chart-heading">Quantity Score of Participants</div>
        <canvas id="quantityChart" width="400" height="300"></canvas>
      </div>
      <div class="winner-table">
        <table id="rankingTable">
          <tr>
            <th><i class="fas fa-user"></i> Rank</th>
            <th><i class="fas fa-user"></i> Seller</th>
            <th><i class="fas fa-recycle"></i> Quantity Score</th>
            <th><i class="fas fa-trophy"></i> Award</th>
          </tr>
          <!-- Top 5 Participants (Sorted by Quantity Score) -->
          <tr>
            <td>1</td>
            <td>Prasad Babu</td>
            <td>79</td>
            <td><span class="winner-award">Gold</span></td>
          </tr>
          <tr>
            <td>2</td>
            <td>Lakshmi Reddy</td>
            <td>78</td>
            <td><span class="winner-award">Silver</span></td>
          </tr>
          <tr>
            <td>3</td>
            <td>Rameshwar Rao</td>
            <td>71</td>
            <td></td>
          </tr>
          <tr>
            <td>4</td>
            <td>Venkateshwarlu</td>
            <td>70</td>
            <td></td>
          </tr>
          <tr>
            <td>5</td>
            <td>Sai Kumar</td>
            <td>65</td>
            <td></td>
          </tr>
        </table>
      </div>
    </div>
    <section class="competition-results">
      <h2 class="competition-heading">Past Competitions Winners and Runners-up</h2>
      <div class="month-buttons">
        <button class="month-button" data-month="January">January</button>
        <button class="month-button" data-month="February">February</button>
        <button class="month-button" data-month="March">March</button>
      </div>
      <!-- Placeholder for top 5 tables -->
      <div id="top5Tables">
        <!-- Initially empty, will be populated dynamically -->
      </div>
      <!-- Placeholder for chart container -->
      </div>
    </section>
  </main>
  <footer>
    <p>Learn more about environmental sustainability or participate in future competitions!</p>
    <a href="home.html">Call to Action</a>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Full data (including participants beyond top 5)
      const fullData = [
        { seller: 'Prasad Babu', quantity: 79 },
        { seller: 'Lakshmi Reddy', quantity: 78 },
        { seller: 'Rameshwar Rao', quantity: 71 },
        { seller: 'Venkateshwarlu', quantity: 70 },
        { seller: 'Sai Kumar', quantity: 65 },
        { seller: 'Srilatha Reddy', quantity: 62 },
        { seller: 'Ravi Shankar', quantity: 60 },
        { seller: 'Padmaja Rao', quantity: 55 },
        { seller: 'Rajeshwari Naidu', quantity: 50 }
      ];
      const userProfile = {
        name: 'Lakshmi Reddy', // Replace with actual user's name
        quantityScore: 78 // Replace with actual user's quantity score
      };
      fullData.sort((a, b) => b.quantity - a.quantity);
      const userRank = fullData.findIndex(data => data.quantity <= userProfile.quantityScore) + 1;
      const userRankBox = document.getElementById('userRankInfo');
      userRankBox.textContent = `${userProfile.name}'s rank: ${userRank}`;

      // Retrieve data from table for top 5
      const table = document.getElementById('rankingTable');
      const rows = Array.from(table.querySelectorAll('tr')).slice(1); // Skip header row

      // Sort rows by quantity score (descending order)
      rows.sort((a, b) => {
        const quantityA = parseInt(a.cells[2].textContent);
        const quantityB = parseInt(b.cells[2].textContent);
        return quantityB - quantityA; // Compare quantities for sorting (descending)
      });

      // Update rank column for top 5
      rows.forEach((row, index) => {
        row.cells[0].textContent = index + 1;
        if (index === 0) {
          row.cells[3].innerHTML = '<span class="winner-award">Gold</span>';
        } else if (index === 1) {
          row.cells[3].innerHTML = '<span class="winner-award">Silver</span>';
        } else {
          row.cells[3].innerHTML = '';
        }
      });

      // Extract seller names and quantities from full data
      const sellers = fullData.map(item => item.seller);
      const quantities = fullData.map(item => item.quantity);

      // Draw chart using Chart.js
      const ctx = document.getElementById('quantityChart').getContext('2d');
      const quantityChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: sellers,
          datasets: [{
            label: 'Quantity Score',
            data: quantities,
            borderColor: '#fdcb6e', /* Line color */
            backgroundColor: 'rgba(253, 203, 110, 0.2)', /* Fill color */
            borderWidth: 2,
            pointBackgroundColor: '#fdcb6e', /* Point color */
            pointRadius: 5, /* Point radius */
            pointHoverRadius: 8 /* Point radius on hover */
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              callbacks: {
                label: function(tooltipItem) {
                  return `Rank: ${tooltipItem.dataIndex + 1} - ${tooltipItem.label}: ${tooltipItem.formattedValue}`;
                }
              }
            }
          },
          scales: {
            x: {
              grid: {
                display: false /* Remove x-axis grid lines */
              },
              ticks: {
                font: {
                  size: 14 /* X-axis tick font size */
                }
              }
            },
            y: {
              grid: {
                display: false /* Remove y-axis grid lines */
              },
              ticks: {
                beginAtZero: true,
                stepSize: 10,
                font: {
                  size: 14 /* Y-axis tick font size */
                }
              }
            }
          }
        }
      });

      // Add hover effect to table rows
      rows.forEach(row => {
        row.addEventListener('mouseover', () => {
          row.style.backgroundColor = '#f2f2f2';
        });

        row.addEventListener('mouseout', () => {
          row.style.backgroundColor = '';
        });
      });
    });

    // Functionality for past months competition

    document.addEventListener('DOMContentLoaded', function () {
        // Data for past months (January, February, March)
        const pastMonthsData = {
          January: [
            { seller: 'Prasad Babu', quantity: 50 },
            { seller: 'Lakshmi Reddy', quantity: 78 },
            { seller: 'Rameshwar Rao', quantity: 71 },
            { seller: 'Venkateshwarlu', quantity: 70 },
            { seller: 'Sai Kumar', quantity: 65 }
          ],
          February: [
            { seller: 'Prasad Babu', quantity: 85 },
            { seller: 'Lakshmi Reddy', quantity: 88 },
            { seller: 'Rameshwar Rao', quantity: 75 },
            { seller: 'Venkateshwarlu', quantity: 72 },
            { seller: 'Sai Kumar', quantity: 68 }
          ],
          March: [
            { seller: 'Prasad Babu', quantity: 92 },
            { seller: 'Lakshmi Reddy', quantity: 88 },
            { seller: 'Rameshwar Rao', quantity: 81 },
            { seller: 'Venkateshwarlu', quantity: 78 },
            { seller: 'Sai Kumar', quantity: 97}
          ]
        };
        
      
        const initialMonth = 'January';
      updateTop5Table(initialMonth);

      // Function to update top 5 table based on selected month
      function updateTop5Table(month) {
        const data = pastMonthsData[month];

        // Sort data by quantity score (descending order)
        data.sort((a, b) => b.quantity - a.quantity);

        // Generate HTML for top 5 table
        const tableHTML = `
          <div class="winner-table">
            <table>
              <tr>
                <th><i class="fas fa-user"></i> Rank</th>
                <th><i class="fas fa-user"></i> Seller</th>
                <th><i class="fas fa-recycle"></i> Quantity Score</th>
                <th><i class="fas fa-trophy"></i> Award</th>
              </tr>
              ${data.slice(0, 5).map((item, index) => `
                <tr>
                  <td>${index + 1}</td>
                  <td>${item.seller}</td>
                  <td>${item.quantity}</td>
                  <td>${index === 0 ? '<span class="winner-award">Gold</span>' : (index === 1 ? '<span class="winner-award">Silver</span>' : '')}</td>
                </tr>
              `).join('')}
            </table>
          </div>
        `;

        // Update HTML of top 5 tables container
        document.getElementById('top5Tables').innerHTML = tableHTML;
      }

      // Event listeners for month buttons
      const monthButtons = document.querySelectorAll('.month-button');
      monthButtons.forEach(button => {
        button.addEventListener('click', () => {
          const selectedMonth = button.getAttribute('data-month');
          updateTop5Table(selectedMonth);
        });
      });
    });
  </script>
</body>
</html>
{% block content %}